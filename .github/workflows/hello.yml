name: CI Pipeline

on:
  push:
    branches:
      - main
      - dev
  pull_request:

jobs:
  build:
    name: Build Job
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Starting the build stage
        run: echo "Starting the build stage..."

      - name: Say hello
        run: echo "Hello, ${{ github.actor }}! Building your project."

      - name: Create build artifacts
        run: |
          mkdir build_artifacts
          echo "This is a build artifact." > build_artifacts/output.txt

      - name: Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: build_artifacts
          path: build_artifacts/

  test:
    name: Test Job
    runs-on: ubuntu-latest
    needs: build   # Waits for build job to finish

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Download build artifact
        uses: actions/download-artifact@v4
        with:
          name: build_artifacts

      - name: Run tests
        run: |
          echo "Starting the test stage..."
          echo "Running tests..."
          cat build_artifacts/output.txt
          echo "Tests passed!"

  deploy:
    name: Deploy Job
    runs-on: ubuntu-latest
    needs: test   # Waits for test job to finish
    if: github.ref == 'refs/heads/main'  # Only run on main branch

    environment: production

    steps:
      - name: Starting deploy stage
        run: echo "Starting the deploy stage..."

      - name: Deploy to production
        run: |
          echo "Deploying to production environment: ${{ github.ref_name }}"
          echo "Deployment complete!"
